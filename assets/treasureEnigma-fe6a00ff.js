import{i as p,g as y}from"./job-44d143fb.js";import{g as d,w as h,f}from"./firebase-6d97cafc.js";import{t as s}from"./translate-185f5959.js";import{t as e,a as A}from"./layers-172ce3de.js";import{r as k}from"./config-adf52b6e.js";import{s as v}from"./switchingTiles-a75bcebc.js";import{o as W,t as E}from"./discussionv2-8cccfd78.js";import{i as T,s as L}from"./readRunes-d68c0484.js";import{i as S,h as n,d as B}from"./inventory-7d72f857.js";import{n as G}from"./notifications-bb73e947.js";import{i as H,c as w,a as l,h as m,b as u,p as g}from"./sounds-0b5a1cc8.js";import{o as Z}from"./init-337d09bc.js";import{d as F,a as x,b as R}from"./ui-ca9d2579.js";const c="treasureEnigma";Z(c).then(async()=>{await p(),F(),x(),R();let r;d().then(i=>{if((i==null?void 0:i.choice)=="online")return;r=WA.sound.loadSound(`${k}/sounds/treasure.mp3`);let b={volume:.1,loop:!1,rate:1,detune:1,delay:0,seek:0,mute:!1};r.play(b)}),H([{name:"evilGuySound",path:"evilGuy.mp3"}]),S(),T(),L("runesReading",{content:"treasureEnigma.runes.content"});let o=null;v("rotatingStatues",()=>{G("treasureEnigma.hammer.opened","utils.success","success"),e("hammerZoneTop",!1),WA.room.onEnterLayer("hammerZone").subscribe(()=>{n("hammer")||(o=WA.ui.displayActionMessage({message:s("utils.executeAction",{action:s("treasureEnigma.hammer.action")}),callback:()=>{B({id:"hammer",name:"treasureEnigma.hammer.name",image:"hammer.png",description:"treasureEnigma.hammer.description"}),e("hammerZone",!1)}}))}),WA.room.onLeaveLayer("hammerZone").subscribe(()=>{o==null||o.remove(),o=null})},!0,"treasureEnigma.makeTurn");let a=null;w("openTreasureDoor",["breakHourglass1","breakHourglass2"],()=>{g("successSound"),e("torchesOnBottom",!0),e("torchesOnTop",!0),e("treasureDoor",!1),WA.room.setTiles([{x:14,y:13,tile:null,layer:"treasureDoorCollisions"},{x:15,y:13,tile:null,layer:"treasureDoorCollisions"},{x:16,y:13,tile:null,layer:"treasureDoorCollisions"}])}),l("breakHourglass1",()=>{e("hourglass1FullBottom",!1),e("hourglass1FullTop",!1),e("hourglass1BrokenTop",!0),e("hourglass1BrokenBottom",!0)}),WA.room.onEnterLayer("breakHourglass1Zone").subscribe(()=>{n("hammer")&&!m("breakHourglass1")&&(a=WA.ui.displayActionMessage({message:s("utils.executeAction",{action:s("treasureEnigma.breakHourglass")}),callback:()=>{u("breakHourglass1")}}))}),WA.room.onLeaveLayer("breakHourglass1Zone").subscribe(()=>{a==null||a.remove(),a=null}),l("breakHourglass2",()=>{e("hourglass2FullBottom",!1),e("hourglass2FullTop",!1),e("hourglass2BrokenTop",!0),e("hourglass2BrokenBottom",!0)}),WA.room.onEnterLayer("breakHourglass2Zone").subscribe(()=>{n("hammer")&&!m("breakHourglass2")&&(a=WA.ui.displayActionMessage({message:s("utils.executeAction",{action:s("treasureEnigma.breakHourglass")}),callback:()=>{u("breakHourglass2")}}))}),WA.room.onLeaveLayer("breakHourglass2Zone").subscribe(()=>{a==null||a.remove(),a=null}),l("evilGuyAppears",async()=>{WA.controls.disablePlayerControls(),WA.camera.set(15*32+16,4*32+16,50,50,!0,!0),g("evilGuySound"),await h(1e3),setTimeout(()=>{e("badGuy",!0)},300),await A(["pouf1","pouf2","pouf3"],100);const i=await y();setTimeout(()=>{W(E.badGuy,"treasureEnigma.badGuy.monologue","views.choice.close","discussion",async()=>{r==null||r.stop(),await f(c),WA.nav.goToRoom(`./bomb.tmj#${i}-entry`)})},300)});let t=null;WA.room.onEnterLayer("treasure").subscribe(()=>{t=WA.ui.displayActionMessage({message:s("utils.executeAction",{action:s("treasureEnigma.takeTheTreasure")}),callback:()=>{u("evilGuyAppears")}})}),WA.room.onLeaveLayer("treasure").subscribe(()=>{t==null||t.remove(),t=null})});
