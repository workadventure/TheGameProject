import{t as r}from"./translate-a92a2393.js";import{l as u,n as W}from"./firebase-f59070e7.js";import{r as p}from"./config-adf52b6e.js";var A=(e=>(e.archaeologistPlayer="archaeologistPlayer",e.spyPlayer="spyPlayer",e))(A||{});const i="job",t={public:!0,persist:!0,scope:"world"},l={archaeologist:{useComputers:!1,speakAncienLanguages:!0,readRunes:!0,makeExcavation:!0,findSecretPassages:!1,makeHooking:!1},spy:{useComputers:!0,speakAncienLanguages:!1,readRunes:!1,makeExcavation:!1,findSecretPassages:!0,makeHooking:!0}},b="jobWalletButton";let s=null;const o=e=>{WA.player.state.saveVariable(i,e,t),WA.player.removeOutlineColor(),e==="spy"&&WA.player.setOutlineColor(0,0,0),e==="archaeologist"&&WA.player.setOutlineColor(85,53,42),e&&W(e)},m=()=>{const e=WA.state.loadVariable("archaeologistPlayer"),a=WA.state.loadVariable("spyPlayer");(e==null||e!==!1&&e.uuid===WA.player.uuid)&&WA.state.saveVariable("archaeologistPlayer",!1),(!a||a==null)&&WA.state.saveVariable("spyPlayer",{uuid:WA.player.uuid,name:WA.player.name}),o("spy")},v=()=>{const e=WA.state.loadVariable("archaeologistPlayer"),a=WA.state.loadVariable("spyPlayer");(!e||e==null)&&WA.state.saveVariable("archaeologistPlayer",{uuid:WA.player.uuid,name:WA.player.name}),(e==null||a!==!1&&a.uuid===WA.player.uuid)&&WA.state.saveVariable("spyPlayer",!1),o("archaeologist")},j=()=>{const e=WA.state.loadVariable("spyPlayer");e&&e.uuid!==WA.player.uuid||(WA.state.saveVariable("spyPlayer",!1),o(void 0))},V=()=>{const e=WA.state.loadVariable("archaeologistPlayer");e&&e.uuid!==WA.player.uuid&&WA.state.saveVariable("archaeologistPlayer",!1),o(void 0)},d=async()=>{if(WA.player.state.job)return WA.player.state.job;const e=await u();return e==null?!1:(WA.player.state.job=e.job,e.job)},f=async()=>{WA.controls.disablePlayerControls(),s=await WA.ui.website.open({url:`${p}/views/jobWallet/jobWallet.html`,allowApi:!0,allowPolicy:"",position:{vertical:"middle",horizontal:"middle"},size:{height:"50vh",width:"50vw"}}),WA.player.state.saveVariable("askForJobWalletWebsiteClose",!1,t)},J=()=>{WA.player.state.saveVariable("askForJobWalletWebsiteClose",!0,t)},c=()=>{s==null||s.close(),s=null,WA.controls.restorePlayerControls()},n=()=>{WA.ui.actionBar.addButton({id:b,label:r("modules.job.myJobWallet.label"),callback:async()=>{s?c():await f()}})},y=()=>{WA.ui.actionBar.removeButton(b)},k=async()=>{WA.controls.disablePlayerControls(),await d(),console.info("initiateJob => My job is: ",WA.player.state.job),WA.player.state.job?n():(y(),WA.player.state.saveVariable(i,!1,t)),WA.player.state.onVariableChange(i).subscribe(e=>{e?(console.info(r("modules.job.jobChanged",{job:r(`modules.job.jobs.${e}`)})),n()):y()}),WA.player.state.onVariableChange("askForJobWalletWebsiteClose").subscribe(e=>{e&&c()}),WA.controls.restorePlayerControls()},C=e=>WA.player.state.job&&l[WA.player.state.job][e],w=()=>WA.player.state.job&&l[WA.player.state.job]?Object.keys(l[WA.player.state.job]).filter(e=>l[WA.player.state.job][e]):null,B=()=>{WA.state.saveVariable("allPlayersGotJob",!1);const e=WA.state.loadVariable("spyPlayer"),a=WA.state.loadVariable("archaeologistPlayer");e!=null&&e!=!1&&a!=null&&a!=!1&&WA.state.saveVariable("allPlayersGotJob",!0)};export{A as J,m as a,j as b,B as c,w as d,J as e,C as f,d as g,k as i,v as s,V as u};
