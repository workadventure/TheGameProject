import{i as p,g as y}from"./job-d586efa0.js";import{w as d,e as h}from"./firebase-09ce58cb.js";import{t as s}from"./translate-a92a2393.js";import{t as e,a as f}from"./layers-2a00048c.js";import{r as A}from"./config-3db041a0.js";import{s as k}from"./switchingTiles-f2a54248.js";import{o as v,t as W}from"./discussionv2-a040ca14.js";import{i as E,s as T}from"./readRunes-7fad604a.js";import{i as L,h as t,d as S}from"./inventory-abbb333d.js";import{n as B}from"./notifications-cef40a46.js";import{i as G,c as H,a as i,h as u,b as n,p as m}from"./sounds-38d81953.js";import{o as w}from"./init-01709531.js";import{d as Z,a as x,b as F}from"./ui-ca9d2579.js";const c="treasureEnigma";w(c).then(async()=>{await p(),Z(),x(),F();const l=WA.sound.loadSound(`${A}/sounds/treasure.mp3`);let g={volume:.1,loop:!1,rate:1,detune:1,delay:0,seek:0,mute:!1};l.play(g),G([{name:"evilGuySound",path:"evilGuy.mp3"}]),L(),E(),T("runesReading",{content:"treasureEnigma.runes.content"});let o=null;k("rotatingStatues",()=>{B("treasureEnigma.hammer.opened","utils.success","success"),e("hammerZoneTop",!1),WA.room.onEnterLayer("hammerZone").subscribe(()=>{t("hammer")||(o=WA.ui.displayActionMessage({message:s("utils.executeAction",{action:s("treasureEnigma.hammer.action")}),callback:()=>{S({id:"hammer",name:"treasureEnigma.hammer.name",image:"hammer.png",description:"treasureEnigma.hammer.description"}),e("hammerZone",!1)}}))}),WA.room.onLeaveLayer("hammerZone").subscribe(()=>{o==null||o.remove(),o=null})},!0,"treasureEnigma.makeTurn");let a=null;H("openTreasureDoor",["breakHourglass1","breakHourglass2"],()=>{m("successSound"),e("torchesOnBottom",!0),e("torchesOnTop",!0),e("treasureDoor",!1),WA.room.setTiles([{x:14,y:13,tile:null,layer:"treasureDoorCollisions"},{x:15,y:13,tile:null,layer:"treasureDoorCollisions"},{x:16,y:13,tile:null,layer:"treasureDoorCollisions"}])}),i("breakHourglass1",()=>{e("hourglass1FullBottom",!1),e("hourglass1FullTop",!1),e("hourglass1BrokenTop",!0),e("hourglass1BrokenBottom",!0)}),WA.room.onEnterLayer("breakHourglass1Zone").subscribe(()=>{t("hammer")&&!u("breakHourglass1")&&(a=WA.ui.displayActionMessage({message:s("utils.executeAction",{action:s("treasureEnigma.breakHourglass")}),callback:()=>{n("breakHourglass1")}}))}),WA.room.onLeaveLayer("breakHourglass1Zone").subscribe(()=>{a==null||a.remove(),a=null}),i("breakHourglass2",()=>{e("hourglass2FullBottom",!1),e("hourglass2FullTop",!1),e("hourglass2BrokenTop",!0),e("hourglass2BrokenBottom",!0)}),WA.room.onEnterLayer("breakHourglass2Zone").subscribe(()=>{t("hammer")&&!u("breakHourglass2")&&(a=WA.ui.displayActionMessage({message:s("utils.executeAction",{action:s("treasureEnigma.breakHourglass")}),callback:()=>{n("breakHourglass2")}}))}),WA.room.onLeaveLayer("breakHourglass2Zone").subscribe(()=>{a==null||a.remove(),a=null}),i("evilGuyAppears",async()=>{WA.controls.disablePlayerControls(),WA.camera.set(15*32+16,4*32+16,50,50,!0,!0),m("evilGuySound"),await d(1e3),setTimeout(()=>{e("badGuy",!0)},300),await f(["pouf1","pouf2","pouf3"],100);const b=await y();setTimeout(()=>{v(W.badGuy,"treasureEnigma.badGuy.monologue","views.choice.close","discussion",async()=>{l.stop(),await h(c),WA.nav.goToRoom(`./bomb.tmj#${b}-entry`)})},300)});let r=null;WA.room.onEnterLayer("treasure").subscribe(()=>{r=WA.ui.displayActionMessage({message:s("utils.executeAction",{action:s("treasureEnigma.takeTheTreasure")}),callback:()=>{n("evilGuyAppears")}})}),WA.room.onLeaveLayer("treasure").subscribe(()=>{r==null||r.remove(),r=null})});
