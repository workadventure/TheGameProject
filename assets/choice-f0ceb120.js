import{i as p,c,J as t}from"./job-f067f181.js";import{t as s}from"./translate-a92a2393.js";import{g as d,f as A,h as u}from"./firebase-6d97cafc.js";import{r as n}from"./config-adf52b6e.js";import{o as h,t as W}from"./discussionv2-8cccfd78.js";import{i as g,g as f,d as v}from"./inventory-de973741.js";import"./sounds-131a2a9b.js";import{o as L}from"./init-337d09bc.js";import{o as C}from"./ranking-6c0f41de.js";import"./notifications-bb73e947.js";const i=()=>{WA.ui.banner.closeBanner(),WA.ui.banner.openBanner({id:"banner-players-not-even",text:"You need to be at least 2 players to play this game ðŸ™",closable:!1,timeToClose:0})},P=()=>{const o=[...WA.players.list()].find(a=>a.state.job=="spy");return o==null?void 0:o.name},w=()=>{const o=[...WA.players.list()].find(a=>a.state.job=="archaeologist");return o==null?void 0:o.name},r=()=>{const o=WA.state.loadVariable(t.spyPlayer),a=WA.state.loadVariable(t.archaeologistPlayer);WA.ui.banner.closeBanner(),WA.ui.banner.openBanner({id:"banner-players-not-even",text:`${o?o.name:"----"} ðŸ‘€   ${a?a.name:"----"} ðŸ‘¨â€ðŸŒ¾`,closable:!1,timeToClose:0})},y="choice";L(y).then(async()=>{WA.controls.restoreInviteButton();let o;d().then(e=>{if((e==null?void 0:e.choice)==null||(e==null?void 0:e.choice)=="online")return;o=WA.sound.loadSound(`${n}/sounds/choice.mp3`);let b={volume:.1,loop:!1,rate:1,detune:1,delay:0,seek:0,mute:!1};o.play(b)}),g(),await p();let a=!1;WA.room.onEnterLayer("talk").subscribe(()=>{if(a){WA.chat.open();return}WA.chat.sendChatMessage(s("views.choice.text"),`${s("views.choice.title")} ðŸ•µï¸â€â™‚ï¸`),a=!0}),WA.room.onEnterLayer("spy").subscribe(async()=>{if(P()!=null){WA.chat.sendChatMessage("Sorry, the spy job is already taken ðŸ˜±",`${s("views.choice.title")} ðŸ•µï¸â€â™‚ï¸`);return}WA.ui.modal.openModal({allowApi:!0,position:"center",allow:"fullscreen",title:"become spy",src:`${n}/views/choice/becomeSpy.html`},()=>{WA.controls.restorePlayerControls(),c()})}),WA.room.onEnterLayer("archeo").subscribe(async()=>{if(w()!=null){WA.chat.sendChatMessage("Sorry, the spy job is already taken ðŸ˜±",`${s("views.choice.title")} ðŸ•µï¸â€â™‚ï¸`);return}WA.ui.modal.openModal({allowApi:!0,position:"center",allow:"fullscreen",title:"become spy",src:`${n}/views/choice/becomeArchaeologist.html`},()=>{WA.controls.restorePlayerControls(),c()})});let l;WA.room.onEnterLayer("croissants").subscribe(()=>{l=WA.ui.displayActionMessage({message:s("utils.executeAction",{action:s("choice.takeCroissantMessage")}),callback:()=>{const e=f().length;v({id:`croissant${e}`,name:"Croissant",description:"choice.looksDelicious",image:"croissant.png"})}})}),WA.room.onLeaveLayer("croissants").subscribe(()=>{l.remove()}),WA.room.onEnterLayer("door_left_zone").subscribe(()=>{WA.room.hideLayer("closedoor_left"),WA.room.showLayer("opendoor_left")}),WA.room.onLeaveLayer("door_left_zone").subscribe(()=>{WA.room.showLayer("closedoor_left"),WA.room.hideLayer("opendoor_left")}),WA.room.onEnterLayer("door_right_zone").subscribe(()=>{WA.room.hideLayer("closedoor_right"),WA.room.showLayer("opendoor_right")}),WA.room.onLeaveLayer("door_right_zone").subscribe(()=>{WA.room.showLayer("closedoor_right"),WA.room.hideLayer("opendoor_right")}),await WA.players.configureTracking(),WA.players.onPlayerEnters.subscribe(async e=>{console.info(`Player ${e.name} entered your nearby zone`),[...WA.players.list()].length===1?r():i()}),WA.players.onPlayerLeaves.subscribe(async e=>{console.info(`Player ${e.name} leave your nearby zone`),[...WA.players.list()].length===1?r():i()}),WA.state.onVariableChange("allPlayersGotJob").subscribe(async e=>{r(),e&&(o==null||o.stop(),await A(y),u(),WA.ui.modal.closeModal(),WA.ui.banner.closeBanner(),WA.nav.goToRoom("./museum.tmj"))}),WA.state.onVariableChange(t.spyPlayer).subscribe(e=>{console.info("onVariableChange => spyPlayer",e),r()}),WA.state.onVariableChange(t.archaeologistPlayer).subscribe(e=>{console.info("onVariableChange => archaeologistPlayer",e),r()}),WA.player.state.playingModeSelected!=null?m():(WA.player.state.playingModeSelected=!1,WA.player.state.onVariableChange("playingModeSelected").subscribe(e=>{e&&m()}))}).catch(o=>console.error(o));const m=()=>{h(W.voiceOver,"choice.scenario",void 0,void 0,()=>{console.log("Discussion closed"),setTimeout(()=>{C()},500)}),setTimeout(()=>{[...WA.players.list()].length===1?r():i()},5e4)};
