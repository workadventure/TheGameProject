import{i as b,c as y,J as t}from"./job-d586efa0.js";import{t as s}from"./translate-a92a2393.js";import{e as h,f as p}from"./firebase-09ce58cb.js";import{r as n}from"./config-3db041a0.js";import{o as d,t as u}from"./discussionv2-a040ca14.js";import{i as A,g as W,d as g}from"./inventory-abbb333d.js";import"./sounds-38d81953.js";import{h as f}from"./workadventureFeatures-48ab46db.js";import{o as v}from"./init-01709531.js";import{o as L}from"./ranking-a175e80a.js";import"./notifications-cef40a46.js";const i=()=>{WA.ui.banner.closeBanner(),WA.ui.banner.openBanner({id:"banner-players-not-even",text:"You need to be at least 2 players to play this game ðŸ™",closable:!1,timeToClose:0})},C=()=>{const e=[...WA.players.list()].find(a=>a.state.job=="spy");return e==null?void 0:e.name},P=()=>{const e=[...WA.players.list()].find(a=>a.state.job=="archaeologist");return e==null?void 0:e.name},r=()=>{const e=WA.state.loadVariable(t.spyPlayer),a=WA.state.loadVariable(t.archaeologistPlayer);WA.ui.banner.closeBanner(),WA.ui.banner.openBanner({id:"banner-players-not-even",text:`${e?e.name:"----"} ðŸ‘€   ${a?a.name:"----"} ðŸ‘¨â€ðŸŒ¾`,closable:!1,timeToClose:0})},m="choice";v(m).then(async()=>{const e=WA.sound.loadSound(`${n}/sounds/choice.mp3`);let a={volume:.1,loop:!1,rate:1,detune:1,delay:0,seek:0,mute:!1};e.play(a),A(),await b(),f();let l=!1;WA.room.onEnterLayer("talk").subscribe(()=>{if(l){WA.chat.open();return}WA.chat.sendChatMessage(s("views.choice.text"),`${s("views.choice.title")} ðŸ•µï¸â€â™‚ï¸`),l=!0}),WA.room.onEnterLayer("spy").subscribe(async()=>{if(C()!=null){WA.chat.sendChatMessage("Sorry, the spy job is already taken ðŸ˜±",`${s("views.choice.title")} ðŸ•µï¸â€â™‚ï¸`);return}WA.ui.modal.openModal({allowApi:!0,position:"center",allow:"fullscreen",title:"become spy",src:`${n}/views/choice/becomeSpy.html`},()=>{WA.controls.restorePlayerControls(),y()})}),WA.room.onEnterLayer("archeo").subscribe(async()=>{if(P()!=null){WA.chat.sendChatMessage("Sorry, the spy job is already taken ðŸ˜±",`${s("views.choice.title")} ðŸ•µï¸â€â™‚ï¸`);return}WA.ui.modal.openModal({allowApi:!0,position:"center",allow:"fullscreen",title:"become spy",src:`${n}/views/choice/becomeArchaeologist.html`},()=>{WA.controls.restorePlayerControls(),y()})});let c;WA.room.onEnterLayer("croissants").subscribe(()=>{c=WA.ui.displayActionMessage({message:s("utils.executeAction",{action:s("choice.takeCroissantMessage")}),callback:()=>{const o=W().length;g({id:`croissant${o}`,name:"Croissant",description:"choice.looksDelicious",image:"croissant.png"})}})}),WA.room.onLeaveLayer("croissants").subscribe(()=>{c.remove()}),WA.room.onEnterLayer("door_left_zone").subscribe(()=>{WA.room.hideLayer("closedoor_left"),WA.room.showLayer("opendoor_left")}),WA.room.onLeaveLayer("door_left_zone").subscribe(()=>{WA.room.showLayer("closedoor_left"),WA.room.hideLayer("opendoor_left")}),WA.room.onEnterLayer("door_right_zone").subscribe(()=>{WA.room.hideLayer("closedoor_right"),WA.room.showLayer("opendoor_right")}),WA.room.onLeaveLayer("door_right_zone").subscribe(()=>{WA.room.showLayer("closedoor_right"),WA.room.hideLayer("opendoor_right")}),await WA.players.configureTracking(),WA.players.onPlayerEnters.subscribe(async o=>{console.info(`Player ${o.name} entered your nearby zone`),[...WA.players.list()].length===1?r():i()}),WA.players.onPlayerLeaves.subscribe(async o=>{console.info(`Player ${o.name} leave your nearby zone`),[...WA.players.list()].length===1?r():i()}),WA.state.onVariableChange("allPlayersGotJob").subscribe(async o=>{r(),o&&(e.stop(),await h(m),p(),WA.ui.modal.closeModal(),WA.nav.goToRoom("./museum.tmj"))}),WA.state.onVariableChange(t.spyPlayer).subscribe(o=>{console.info("onVariableChange => spyPlayer",o),r()}),WA.state.onVariableChange(t.archaeologistPlayer).subscribe(o=>{console.info("onVariableChange => archaeologistPlayer",o),r()}),WA.player.state.playingModeSelected=!1,WA.player.state.onVariableChange("playingModeSelected").subscribe(o=>{console.log("onVariableChange => playingModeSelected",o),o&&(d(u.voiceOver,"choice.scenario",void 0,void 0,()=>{console.log("Discussion closed"),setTimeout(()=>{L()},500)}),setTimeout(()=>{[...WA.players.list()].length===1?r():i()},5e4))})}).catch(e=>console.error(e));
