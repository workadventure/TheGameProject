import{f as F,i as L}from"./job-f067f181.js";import{t as o}from"./translate-a92a2393.js";import{p as g}from"./sounds-131a2a9b.js";import{g as S,j as m,f as w,k as c}from"./firebase-6d97cafc.js";import{i as f}from"./hiddenZone-85a4635d.js";import{r as B}from"./config-adf52b6e.js";import{i as T}from"./switchingTiles-d04a9ba0.js";import{r as d,i as z,d as i}from"./inventory-de973741.js";import{s as G}from"./hooking-0daa4877.js";import{h as v}from"./workadventureFeatures-48ab46db.js";import{o as $}from"./init-337d09bc.js";import{d as O,a as R,b as k}from"./ui-ca9d2579.js";import"./notifications-bb73e947.js";let l=null;const p=(e=["excavationZone"],r=null)=>{for(let a=0;a<e.length;a++)WA.state[`${e[a]}Discovered`]?(WA.room.hideLayer(`${e[a]}/trace`),WA.room.hideLayer(`${e[a]}/search`),WA.room.showLayer(`${e[a]}/found`),r&&r[a]&&r[a]()):(F("makeExcavation")?(WA.room.showLayer(`${e[a]}/trace`),WA.room.onEnterLayer(`${e[a]}/trace`).subscribe(()=>{WA.state[`${e[a]}Discovered`]||(l=WA.ui.displayActionMessage({message:o("utils.executeAction",{action:o("modules.excavation.makeExcavations")}),callback:()=>{WA.state[`${e[a]}Discovered`]=!0}}))}),WA.room.onLeaveLayer(`${e[a]}/trace`).subscribe(()=>{l==null||l.remove()})):(WA.room.hideLayer(`${e[a]}/trace`),WA.room.hideLayer(`${e[a]}/search`),WA.room.hideLayer(`${e[a]}/found`)),WA.state.onVariableChange(`${e[a]}Discovered`).subscribe(()=>{E(e[a],r?r[a]:null)}))},E=(e,r=null)=>{WA.room.hideLayer(`${e}/trace`),WA.room.showLayer(`${e}/search`),setTimeout(()=>{WA.room.showLayer(`${e}/found`),setTimeout(()=>{WA.room.hideLayer(`${e}/search`),g("successSound"),r&&r()},1e3)},3e3)},y="maze";$(y).then(async()=>{O(),R(),k();let e=null;WA.room.onEnterLayer("triggerBlue").subscribe(()=>{WA.state.blueFire?e=WA.ui.displayActionMessage({message:o("maze.fireOn"),callback:()=>{}}):WA.player.state.hasFoundBlueSeed?e=WA.ui.displayActionMessage({message:o("maze.triggerBlue"),callback:()=>{d("powder"),WA.state.blueFire=!0}}):e=WA.ui.displayActionMessage({message:o("maze.empty"),callback:()=>{}})}),WA.room.onLeaveLayer("triggerBlue").subscribe(()=>{e==null||e.remove()});let r=null;WA.room.onEnterLayer("triggerRed").subscribe(()=>{WA.state.redFire?r=WA.ui.displayActionMessage({message:o("maze.fireOn"),callback:()=>{}}):WA.player.state.hasFoundRedSeed?r=WA.ui.displayActionMessage({message:o("maze.triggerRed"),callback:()=>{d("gem"),WA.state.redFire=!0}}):r=WA.ui.displayActionMessage({message:o("maze.empty"),callback:()=>{}})}),WA.room.onLeaveLayer("triggerRed").subscribe(()=>{r==null||r.remove()});let a=null;WA.room.onEnterLayer("triggerGreen").subscribe(()=>{WA.state.greenFire?a=WA.ui.displayActionMessage({message:o("maze.fireOn"),callback:()=>{d("seed"),WA.state.greenFire=!0}}):WA.player.state.hasFoundGreenSeed?a=WA.ui.displayActionMessage({message:o("maze.triggerGreen"),callback:()=>{d("seed"),WA.state.greenFire=!0}}):a=WA.ui.displayActionMessage({message:o("maze.empty"),callback:()=>{}})}),WA.room.onLeaveLayer("triggerGreen").subscribe(()=>{a==null||a.remove()}),WA.state.onVariableChange("blueFire").subscribe(s=>{s&&(A(),u())}),WA.state.onVariableChange("redFire").subscribe(s=>{s&&(W(),u())}),WA.state.onVariableChange("greenFire").subscribe(s=>{s&&(h(),u())}),WA.room.onEnterLayer("exit").subscribe(()=>{n==null||n.stop()});let n;S().then(s=>{if((s==null?void 0:s.choice)=="online")return;n=WA.sound.loadSound(`${B}/sounds/forest.mp3`);let b={volume:.1,loop:!1,rate:1,detune:1,delay:0,seek:0,mute:!1};n.play(b)});for(let s=1;s<10;s++)f([{stepIn:`fogFloor/fog${[s]}`,hide:`fog/fog${[s]}`}]);z(),await M(),await L(),v(),WA.player.state.onVariableChange("hasFoundRedSeed").subscribe(()=>{}),WA.player.state.onVariableChange("hasFoundGreenSeed").subscribe(()=>{WA.room.hideLayer("excavations/exca6/found")}),WA.player.state.onVariableChange("hasFoundBlueSeed").subscribe(()=>{WA.room.hideLayer("blueSeed")}),f([{stepIn:"hiddenZoneFloor/hiddenZoneFloor",hide:"hiddenZoneTop"}]),G("hiddenZoneFloor/hooking",async()=>{await C()}),p(["excavations/exca1","excavations/exca2","excavations/exca3","excavations/exca4","excavations/exca5"],[()=>{console.info("Excavation has been made !")}]);let t=null;p(["excavations/exca6"],[()=>{WA.room.onEnterLayer("excavations/exca6/found").subscribe(()=>{WA.player.state.hasFoundGreenSeed||(t=WA.ui.displayActionMessage({message:o("maze.takeSeedMsg"),callback:async()=>{await x()}}))}),WA.room.onLeaveLayer("excavations/exca6/trace").subscribe(()=>{t==null||t.remove()})}]),T(["switchingTiles"],[()=>{WA.room.hideLayer("blueArtifact"),WA.room.showLayer("blueSeed"),WA.room.showLayer("switchTileVictory"),WA.room.onEnterLayer("blueSeed").subscribe(()=>{WA.player.state.hasFoundBlueSeed||(t=WA.ui.displayActionMessage({message:o("maze.takePowderMsg"),callback:async()=>{await D()}}))}),WA.room.onLeaveLayer("blueSeed").subscribe(()=>{t==null||t.remove()})}])});async function M(){await m("hasFoundBlueSeed").then(e=>{e==null||e.find==!1?(WA.player.state.hasFoundBlueSeed=!1,WA.state.blueFire=!1):(WA.player.state.hasFoundBlueSeed=!0,WA.state.blueFire=!0)}).catch(e=>{console.warn("Error getting document:",e),WA.player.state.hasFoundBlueSeed=!1,WA.state.blueFire=!1}),await m("hasFoundGreenSeed").then(e=>{e==null||e.find==!1?(WA.player.state.hasFoundGreenSeed=!1,WA.state.greenFire=!1):(WA.player.state.hasFoundGreenSeed=!0,WA.state.greenFire=!0)}).catch(e=>{console.warn("Error getting document:",e),WA.player.state.hasFoundGreenSeed=!1,WA.state.greenFire=!1}),await m("hasFoundRedSeed").then(e=>{e==null||e.find==!1?(WA.player.state.hasFoundRedSeed=!1,WA.state.redFire=!1):(WA.player.state.hasFoundRedSeed=!0,WA.state.redFire=!0)}).catch(e=>{console.warn("Error getting document:",e),WA.player.state.hasFoundRedSeed=!1,WA.state.redFire=!1}),WA.player.state.hasFoundBlueSeed&&i({id:"powder",name:o("maze.powder"),image:"shard.png",description:o("maze.powderDescription")}),WA.player.state.hasFoundGreenSeed&&i({id:"seed",name:o("maze.seed"),image:"seed.png",description:o("maze.seedDescription")}),WA.player.state.hasFoundRedSeed&&i({id:"gem",name:o("maze.gem"),image:"gem.png",description:o("maze.gemDescription")}),h(),W(),A(),u(),console.info("Has found blue seed: ",WA.player.state.hasFoundBlueSeed),console.info("Has found green seed: ",WA.player.state.hasFoundGreenSeed),console.info("Has found red seed: ",WA.player.state.hasFoundRedSeed),console.info("Blue fire: ",WA.state.blueFire),console.info("Green fire: ",WA.state.greenFire),console.info("Red fire: ",WA.state.redFire)}async function D(){WA.player.state.hasFoundBlueSeed=!0,i({id:"powder",name:o("maze.powder"),image:"shard.png",description:o("maze.powderDescription")}),await c("hasFoundBlueSeed")}async function x(){WA.player.state.hasFoundGreenSeed=!0,i({id:"seed",name:o("maze.seed"),image:"seed.png",description:o("maze.seedDescription")}),await c("hasFoundGreenSeed")}async function C(){WA.player.state.hasFoundRedSeed=!0,i({id:"gem",name:o("maze.gem"),image:"gem.png",description:o("maze.gemDescription")}),await c("hasFoundRedSeed")}const A=()=>{WA.state.blueFire&&(WA.room.hideLayer("torchesTop/offTop/torcheBlueOffTop"),WA.room.hideLayer("torchesBot/offBot/torcheBlueOffBot"),WA.room.showLayer("torchesTop/onTop/torcheBlueOnTop"),WA.room.showLayer("torchesBot/onBot/torcheBlueOnBot"))},h=()=>{WA.state.greenFire&&(WA.room.hideLayer("torchesTop/offTop/torcheGreenOffTop"),WA.room.hideLayer("torchesBot/offBot/torcheGreenOffBot"),WA.room.showLayer("torchesTop/onTop/torcheGreenOnTop"),WA.room.showLayer("torchesBot/onBot/torcheGreenOnBot"))},W=()=>{WA.state.redFire&&(WA.room.hideLayer("torchesTop/offTop/torcheRedOffTop"),WA.room.hideLayer("torchesBot/offBot/torcheRedOffBot"),WA.room.showLayer("torchesTop/onTop/torcheRedOnTop"),WA.room.showLayer("torchesBot/onBot/torcheRedOnBot"))},u=()=>{WA.state.blueFire&&WA.state.redFire&&WA.state.greenFire&&(w(y),g("successSound"),WA.room.showLayer("dragonTopLight"),WA.room.showLayer("dragonLight"),WA.room.showLayer("mountainDoorAnimate"),WA.room.setTiles([{x:16,y:4,tile:null,layer:"collisions"}]),A(),h(),W())};
