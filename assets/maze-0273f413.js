import{f as F,i as L}from"./job-1b9471bc.js";import{t as r}from"./translate-1ba34e64.js";import{p}from"./sounds-bea9d6c6.js";import{g as S,j as m,f as w,k as c}from"./firebase-6d97cafc.js";import{i as f}from"./hiddenZone-85a4635d.js";import{r as B}from"./config-adf52b6e.js";import{i as T}from"./switchingTiles-d25ba0c0.js";import{r as d,i as z,d as i}from"./inventory-ee95aa34.js";import{s as G}from"./hooking-57e8ac30.js";import{o as v}from"./init-13cd6e65.js";import{d as $,a as O,b as R}from"./ui-ca9d2579.js";import"./notifications-bb73e947.js";let l=null;const y=(e=["excavationZone"],o=null)=>{for(let a=0;a<e.length;a++)WA.state[`${e[a]}Discovered`]?(WA.room.hideLayer(`${e[a]}/trace`),WA.room.hideLayer(`${e[a]}/search`),WA.room.showLayer(`${e[a]}/found`),o&&o[a]&&o[a]()):(F("makeExcavation")?(WA.room.showLayer(`${e[a]}/trace`),WA.room.onEnterLayer(`${e[a]}/trace`).subscribe(()=>{WA.state[`${e[a]}Discovered`]||(l=WA.ui.displayPlayerMessage({message:r("utils.executeAction",{action:r("modules.excavation.makeExcavations")}),callback:()=>{WA.state[`${e[a]}Discovered`]=!0}}))}),WA.room.onLeaveLayer(`${e[a]}/trace`).subscribe(()=>{l==null||l.remove()})):(WA.room.hideLayer(`${e[a]}/trace`),WA.room.hideLayer(`${e[a]}/search`),WA.room.hideLayer(`${e[a]}/found`)),WA.state.onVariableChange(`${e[a]}Discovered`).subscribe(()=>{k(e[a],o?o[a]:null)}))},k=(e,o=null)=>{WA.room.hideLayer(`${e}/trace`),WA.room.showLayer(`${e}/search`),setTimeout(()=>{WA.room.showLayer(`${e}/found`),setTimeout(()=>{WA.room.hideLayer(`${e}/search`),p("successSound"),o&&o()},1e3)},3e3)},g="maze";v(g).then(async()=>{$(),O(),R();let e=null;WA.room.onEnterLayer("triggerBlue").subscribe(()=>{WA.state.blueFire?e=WA.ui.displayPlayerMessage({message:r("maze.fireOn"),callback:()=>{}}):WA.player.state.hasFoundBlueSeed?e=WA.ui.displayPlayerMessage({message:r("maze.triggerBlue"),callback:()=>{d("powder"),WA.state.blueFire=!0}}):e=WA.ui.displayPlayerMessage({message:r("maze.empty"),callback:()=>{}})}),WA.room.onLeaveLayer("triggerBlue").subscribe(()=>{e==null||e.remove()});let o=null;WA.room.onEnterLayer("triggerRed").subscribe(()=>{WA.state.redFire?o=WA.ui.displayPlayerMessage({message:r("maze.fireOn"),callback:()=>{}}):WA.player.state.hasFoundRedSeed?o=WA.ui.displayPlayerMessage({message:r("maze.triggerRed"),callback:()=>{d("gem"),WA.state.redFire=!0}}):o=WA.ui.displayPlayerMessage({message:r("maze.empty"),callback:()=>{}})}),WA.room.onLeaveLayer("triggerRed").subscribe(()=>{o==null||o.remove()});let a=null;WA.room.onEnterLayer("triggerGreen").subscribe(()=>{WA.state.greenFire?a=WA.ui.displayPlayerMessage({message:r("maze.fireOn"),callback:()=>{d("seed"),WA.state.greenFire=!0}}):WA.player.state.hasFoundGreenSeed?a=WA.ui.displayPlayerMessage({message:r("maze.triggerGreen"),callback:()=>{d("seed"),WA.state.greenFire=!0}}):a=WA.ui.displayPlayerMessage({message:r("maze.empty"),callback:()=>{}})}),WA.room.onLeaveLayer("triggerGreen").subscribe(()=>{a==null||a.remove()}),WA.state.onVariableChange("blueFire").subscribe(s=>{s&&(h(),u())}),WA.state.onVariableChange("redFire").subscribe(s=>{s&&(W(),u())}),WA.state.onVariableChange("greenFire").subscribe(s=>{s&&(A(),u())}),WA.room.onEnterLayer("exit").subscribe(()=>{n==null||n.stop()});let n;S().then(s=>{if((s==null?void 0:s.choice)=="online")return;n=WA.sound.loadSound(`${B}/sounds/forest.mp3`);let b={volume:.1,loop:!1,rate:1,detune:1,delay:0,seek:0,mute:!1};n.play(b)});for(let s=1;s<10;s++)f([{stepIn:`fogFloor/fog${[s]}`,hide:`fog/fog${[s]}`}]);z(),await E(),await L(),WA.player.state.onVariableChange("hasFoundRedSeed").subscribe(()=>{}),WA.player.state.onVariableChange("hasFoundGreenSeed").subscribe(()=>{WA.room.hideLayer("excavations/exca6/found")}),WA.player.state.onVariableChange("hasFoundBlueSeed").subscribe(()=>{WA.room.hideLayer("blueSeed")}),f([{stepIn:"hiddenZoneFloor/hiddenZoneFloor",hide:"hiddenZoneTop"}]),G("hiddenZoneFloor/hooking",async()=>{await D()}),y(["excavations/exca1","excavations/exca2","excavations/exca3","excavations/exca4","excavations/exca5"],[()=>{console.info("Excavation has been made !")}]);let t=null;y(["excavations/exca6"],[()=>{WA.room.onEnterLayer("excavations/exca6/found").subscribe(()=>{WA.player.state.hasFoundGreenSeed||(t=WA.ui.displayPlayerMessage({message:r("maze.takeSeedMsg"),callback:async()=>{await P()}}))}),WA.room.onLeaveLayer("excavations/exca6/trace").subscribe(()=>{t==null||t.remove()})}]),T(["switchingTiles"],[()=>{WA.room.hideLayer("blueArtifact"),WA.room.showLayer("blueSeed"),WA.room.showLayer("switchTileVictory"),WA.room.onEnterLayer("blueSeed").subscribe(()=>{WA.player.state.hasFoundBlueSeed||(t=WA.ui.displayPlayerMessage({message:r("maze.takePowderMsg"),callback:async()=>{await M()}}))}),WA.room.onLeaveLayer("blueSeed").subscribe(()=>{t==null||t.remove()})}])});async function E(){await m("hasFoundBlueSeed").then(e=>{e==null||e.find==!1?(WA.player.state.hasFoundBlueSeed=!1,WA.state.blueFire=!1):(WA.player.state.hasFoundBlueSeed=!0,WA.state.blueFire=!0)}).catch(e=>{console.warn("Error getting document:",e),WA.player.state.hasFoundBlueSeed=!1,WA.state.blueFire=!1}),await m("hasFoundGreenSeed").then(e=>{e==null||e.find==!1?(WA.player.state.hasFoundGreenSeed=!1,WA.state.greenFire=!1):(WA.player.state.hasFoundGreenSeed=!0,WA.state.greenFire=!0)}).catch(e=>{console.warn("Error getting document:",e),WA.player.state.hasFoundGreenSeed=!1,WA.state.greenFire=!1}),await m("hasFoundRedSeed").then(e=>{e==null||e.find==!1?(WA.player.state.hasFoundRedSeed=!1,WA.state.redFire=!1):(WA.player.state.hasFoundRedSeed=!0,WA.state.redFire=!0)}).catch(e=>{console.warn("Error getting document:",e),WA.player.state.hasFoundRedSeed=!1,WA.state.redFire=!1}),WA.player.state.hasFoundBlueSeed&&i({id:"powder",name:r("maze.powder"),image:"shard.png",description:r("maze.powderDescription")}),WA.player.state.hasFoundGreenSeed&&i({id:"seed",name:r("maze.seed"),image:"seed.png",description:r("maze.seedDescription")}),WA.player.state.hasFoundRedSeed&&i({id:"gem",name:r("maze.gem"),image:"gem.png",description:r("maze.gemDescription")}),A(),W(),h(),u(),console.info("Has found blue seed: ",WA.player.state.hasFoundBlueSeed),console.info("Has found green seed: ",WA.player.state.hasFoundGreenSeed),console.info("Has found red seed: ",WA.player.state.hasFoundRedSeed),console.info("Blue fire: ",WA.state.blueFire),console.info("Green fire: ",WA.state.greenFire),console.info("Red fire: ",WA.state.redFire)}async function M(){WA.player.state.hasFoundBlueSeed=!0,i({id:"powder",name:r("maze.powder"),image:"shard.png",description:r("maze.powderDescription")}),await c("hasFoundBlueSeed")}async function P(){WA.player.state.hasFoundGreenSeed=!0,i({id:"seed",name:r("maze.seed"),image:"seed.png",description:r("maze.seedDescription")}),await c("hasFoundGreenSeed")}async function D(){WA.player.state.hasFoundRedSeed=!0,i({id:"gem",name:r("maze.gem"),image:"gem.png",description:r("maze.gemDescription")}),await c("hasFoundRedSeed")}const h=()=>{WA.state.blueFire&&(WA.room.hideLayer("torchesTop/offTop/torcheBlueOffTop"),WA.room.hideLayer("torchesBot/offBot/torcheBlueOffBot"),WA.room.showLayer("torchesTop/onTop/torcheBlueOnTop"),WA.room.showLayer("torchesBot/onBot/torcheBlueOnBot"))},A=()=>{WA.state.greenFire&&(WA.room.hideLayer("torchesTop/offTop/torcheGreenOffTop"),WA.room.hideLayer("torchesBot/offBot/torcheGreenOffBot"),WA.room.showLayer("torchesTop/onTop/torcheGreenOnTop"),WA.room.showLayer("torchesBot/onBot/torcheGreenOnBot"))},W=()=>{WA.state.redFire&&(WA.room.hideLayer("torchesTop/offTop/torcheRedOffTop"),WA.room.hideLayer("torchesBot/offBot/torcheRedOffBot"),WA.room.showLayer("torchesTop/onTop/torcheRedOnTop"),WA.room.showLayer("torchesBot/onBot/torcheRedOnBot"))},u=()=>{WA.state.blueFire&&WA.state.redFire&&WA.state.greenFire&&(w(g),p("successSound"),WA.room.showLayer("dragonTopLight"),WA.room.showLayer("dragonLight"),WA.room.showLayer("mountainDoorAnimate"),WA.room.setTiles([{x:16,y:4,tile:null,layer:"collisions"}]),h(),A(),W())};
