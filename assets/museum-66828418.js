import{b as J}from"./init-7741dda9.js";import{i as j,g as K,e as F}from"./job-eb8dc8ef.js";import{t as o}from"./translate-d272070d.js";import{t as a}from"./layers-a51a04ec.js";import{i as q}from"./hiddenZone-8ca7275f.js";import{r as w,a as p,h as G,b as g,d as f}from"./sounds-5d3f972e.js";import{o as i}from"./discussion-49536565.js";import{o as Q}from"./init-0f7c740a.js";import{i as X,h as k,d as P}from"./inventory-cca9f553.js";import{s as Y}from"./hooking-43362ee1.js";import{n as _}from"./notifications-69979190.js";import{i as ee,g as se,a as oe,c as te,s as ae,o as ie}from"./cameraMovingMode-4f6c173b.js";import{c as re,i as le,o as ne,d as ce}from"./digicode-d3bcf132.js";import{h as me,a as ue,b as de}from"./workadventureFeatures-48ab46db.js";J();let C,y=0;Q().then(async()=>{await j();const r=WA.sound.loadSound(`${w}/sounds/electro.mp3`),l=WA.sound.loadSound(`${w}/sounds/electroLow.mp3`);let M={volume:.4,loop:!0,rate:1,detune:1,delay:0,seek:0,mute:!1},S={volume:1,loop:!0,rate:1,detune:1,delay:0,seek:0,mute:!1};l.play(M),WA.room.onEnterLayer("electroH").subscribe(()=>{l.stop(),r.play(S)}),WA.room.onLeaveLayer("electroH").subscribe(()=>{r.stop(),l.play(M)}),p("retrieveMap",()=>{P({id:"secret-map",name:"museum.secretMap.title",image:"secret-map.png",description:"museum.secretMap.description"}),_("museum.mapRetrieved","utils.success","success"),a(["chestOpened"],!0),ce()}),re("chestDigicode",[{code:"160616",callback:()=>{WA.state.mapRetrieved=!0,g("retrieveMap")}}]),le();let m=null;WA.room.onEnterLayer("chestZone").subscribe(()=>{G("retrieveMap")||(m=WA.ui.displayActionMessage({message:o("utils.executeAction",{action:o("museum.inspect")}),callback:()=>{ne("chestDigicode")}}))}),WA.room.onLeaveLayer("chestZone").subscribe(()=>{m==null||m.remove(),m=null}),me(),ue(),de(),ee(),X();let u=null;WA.room.onEnterLayer("start").subscribe(()=>{WA.state.mapRetrieved&&(u=WA.ui.displayActionMessage({message:o("utils.executeAction",{action:o("museum.escape")}),callback:()=>{l.stop(),T(),WA.nav.goToRoom("maze.tmj")}}))}),WA.room.onLeaveLayer("start").subscribe(()=>{u==null||u.remove(),u=null});const D=()=>{T(),i(WA.player.name,"views.museum.beginDiscussion","views.choice.close","discussion",()=>{WA.controls.restorePlayerControls(),$()})};(()=>{WA.controls.disablePlayerControls(),i("utils.voiceOver","views.museum.beginText","museum.go","discussion",()=>{D()})})();const $=()=>{WA.ui.actionBar.addButton({id:"planButton",label:o("museum.plan"),callback:()=>{D()}})},T=()=>{WA.ui.actionBar.removeButton("planButton")};let A=!1,b=null;const O=()=>{b=setInterval(()=>{a("lights/lights1",A),a("lights/lights2",!A),A=!A},300)},V=()=>{b&&clearInterval(b),b=null},Z=()=>{O(),a("noLights/noLights",!1),a("noLights/conversations",!1),a("lights/conversations",!0)},I=()=>{V(),a("lights/lights1",!1),a("lights/lights2",!1),a("noLights/noLights",!0),a("noLights/conversations",!0),a("lights/conversations",!1)};Y("hookingD7",()=>{const e=[];e.push({x:5,y:67,tile:null,layer:"hookingD7/collides"}),WA.room.setTiles(e)});let h=null;WA.room.onEnterLayer("closeDoorMessage").subscribe(()=>{h=WA.ui.displayActionMessage({message:o("museum.doorClosed"),callback:()=>{}})}),WA.room.onLeaveLayer("closeDoorMessage").subscribe(()=>{h==null||h.remove()}),p("keeperDoorOpen",()=>{const e=[];e.push({x:25,y:44,tile:null,layer:"bigRoomAccess/bigRoomCollides"}),e.push({x:26,y:44,tile:null,layer:"bigRoomAccess/bigRoomCollides"}),WA.room.setTiles(e),WA.room.hideLayer("doorsClosed/dc6")});let W=null;WA.room.onEnterLayer("bigRoomAccess/keeperZone").subscribe(()=>{W=WA.ui.displayActionMessage({message:o("utils.executeAction",{action:o("museum.speakToKeeper")}),callback:()=>{k("id-card")?(i("views.museum.keeperName","views.museum.bigRoomAccess"),g("keeperDoorOpen")):i("views.museum.keeperName","views.museum.bigRoomNoAccess")}})}),WA.room.onLeaveLayer("bigRoomAccess/keeperZone").subscribe(()=>{W==null||W.remove()});for(let e=1;e<8;e++)q([{stepIn:`fogsZone/fog${[e]}`,hide:`fogs/fog${[e]}`}]);const z=e=>{let s=null;WA.room.onEnterLayer(`search/s${e}`).subscribe(()=>{e===5&&!k("id-card")?s=WA.ui.displayActionMessage({message:o("utils.executeAction",{action:o("museum.search")}),callback:()=>{P({id:"id-card",name:"museum.idCardTitle",image:"indentity-card.png",description:"museum.idCardDescription"})}}):s=WA.ui.displayActionMessage({message:o("utils.executeAction",{action:o("museum.search")}),callback:()=>{s=WA.ui.displayActionMessage({message:o("museum.searchEmpty"),callback:()=>{}})}})}),WA.room.onLeaveLayer(`search/s${e}`).subscribe(()=>{s==null||s.remove()})};for(let e=1;e<8;e++)z(e);const H=e=>{let s=null;WA.room.onEnterLayer(`pickPocketInvited/i${e}`).subscribe(()=>{s=WA.ui.displayActionMessage({message:o("utils.executeAction",{action:o("museum.pickpocket")}),callback:()=>{f("switchLights")?i(o("museum.guest"),o("museum.cannotPickPocket"),"views.choice.close","discussion",()=>{i(o("utils.mySelf"),o("museum.needDistraction"),"views.choice.close","discussion")}):e===8&&!k("access-card")?P({id:"access-card",name:"museum.accessCard",image:"gold-key.png",description:"museum.accessCardDescription"}):s=WA.ui.displayActionMessage({message:o("museum.pickpocketEmpty"),callback:()=>{}})}})}),WA.room.onLeaveLayer(`pickPocketInvited/i${e}`).subscribe(()=>{s==null||s.remove()})};for(let e=1;e<13;e++)H(e);p("desktopDoorOpen",()=>{const e=[];e.push({x:38,y:11,tile:null,layer:"desktopCollides"}),e.push({x:39,y:11,tile:null,layer:"desktopCollides"}),WA.room.setTiles(e),WA.room.hideLayer("doorsClosed/dc4")});let n=null;WA.room.onEnterLayer("desktopAccessZone").subscribe(()=>{k("access-card")?n=WA.ui.displayActionMessage({message:o("utils.executeAction",{action:o("museum.desktopOpen")}),callback:()=>{n=WA.ui.displayActionMessage({message:o("museum.desktopOpenMsg"),callback:()=>{g("desktopDoorOpen")}})}}):n=WA.ui.displayActionMessage({message:o("museum.doorClosed"),callback:()=>{}})}),WA.room.onLeaveLayer("desktopAccessZone").subscribe(()=>{n==null||n.remove()});for(let e=0;e<9;e++){let s=null;WA.room.onEnterLayer(`desktopItems/i${e}`).subscribe(()=>{s=WA.ui.displayActionMessage({message:o("utils.executeAction",{action:o("museum.search")}),callback:()=>{e===0?i("views.museum.annuaryTitle","views.museum.annuaryContent"):s=WA.ui.displayActionMessage({message:o(`museum.desktopItems${e}`),callback:()=>{}})}})}),WA.room.onLeaveLayer(`desktopItems/i${e}`).subscribe(()=>{s==null||s.remove()})}const c=["cameraZones/cZone1","cameraZones/cZone2","cameraZones/cZone3","cameraZones/cZone4","cameraZones/cZone5","cameraZones/cZone6"],R=[{x:8*32,y:68*32},{x:26*32,y:68*32},{x:15*32,y:63*32},{x:10*32,y:27*32},{x:47*32,y:23*32},{x:47*32,y:42*32}],t=se(),N={room1:{x:5*32,y:60*32,width:t,height:t},room2:{x:5*32,y:44*32,width:t,height:t},room3:{x:3*32,y:3*32,width:t,height:t},room4:{x:60*32,y:4*32,width:t,height:t},room5:{x:50*32,y:32*32,width:t,height:t},room6:{x:31*32,y:51*32,width:t,height:t},room7:{x:37*32,y:33*32,width:t,height:t}};let L=null;p("deactivateCamera",e=>{for(let s=0;s<c.length;s++)a(c[s],!0);a(e,!1),L===e&&WA.controls.restorePlayerControls()}),p("switchLights",e=>{e?Z():I()},!0),setTimeout(()=>{f("switchLights")?Z():I()},200),WA.player.state.askForSwitchLights===void 0&&(WA.player.state.askForSwitchLights=!0),WA.player.state.askForDeactivateCamera===void 0&&(WA.player.state.askForDeactivateCamera=!1),WA.player.state.askForCloseComputerWebsite===void 0&&(WA.player.state.askForCloseComputerWebsite=!1),WA.player.state.askForSeeRoom===void 0&&(WA.player.state.askForSeeRoom=!1),WA.player.state.onVariableChange("askForDeactivateCamera").subscribe(e=>{e&&g("deactivateCamera",e)}),WA.player.state.onVariableChange("askForCloseComputerWebsite").subscribe(e=>{e&&E()}),WA.player.state.onVariableChange("askForSwitchLights").subscribe(e=>{g("switchLights",e)}),WA.player.state.onVariableChange("askForSeeRoom").subscribe(e=>{const s=N["room"+e];oe(s.x,s.y),a(`fogs/fog${e}`,!1)});for(let e=0;e<c.length;e++)WA.room.onEnterLayer(c[e]).subscribe(()=>{f("deactivateCamera")!==c[e]&&(K()==="spy"?i("utils.mySelf","museum.cantStayInCamera","utils.close","discussion",async()=>{WA.controls.disablePlayerControls(),await WA.player.moveTo(R[e].x,R[e].y),WA.controls.restorePlayerControls()}):(L=c[e],i("utils.mySelf","museum.cannotWalkInCameras","utils.close","discussion",()=>{f("deactivateCamera")!==L&&WA.controls.disablePlayerControls()})))});let v=null;const U=async()=>{WA.ui.modal.openModal({title:"Camera Map",src:`${w}/views/museum/buildingMap.html`,position:"right",allowApi:!0,allow:"fullscreen"},()=>{E()});const e=WA.state.loadVariable("currentCameraPosition");if(e){const{x:s,y:x}=e;B(s,x)}WA.controls.disablePlayerControls(),WA.player.state.askForCloseComputerWebsite=!1,ae(),ie()},E=()=>{v==null||v.close(),v=null,te(),WA.controls.restorePlayerControls(),WA.camera.followPlayer(!0)};let d=null;WA.room.onEnterLayer("computerZone").subscribe(()=>{d=WA.ui.displayActionMessage({message:o("utils.executeAction",{action:o("utils.hack")}),callback:()=>{F("useComputers")?U():i("utils.mySelf","museum.cannotUseComputers","utils.close","discussion")}})}),WA.room.onLeaveLayer("computerZone").subscribe(()=>{d==null||d.remove(),d=null}),WA.state.saveVariable("currentCameraPosition",{x:0,y:0}).catch(e=>console.error("Something went wrong while saving variable",e)),F("useComputers")?WA.state.onVariableChange("currentCameraPosition").subscribe(e=>{const{x:s,y:x}=e;B(s,x)}):WA.player.onPlayerMove(e=>{pe(e)})});const B=(r,l)=>{WA.camera.set(r,l,void 0,void 0,!0,!0),y=0,C=void 0},pe=r=>{y++,y>5?(WA.state.currentCameraPosition={x:r.x,y:r.y},y=0):(C&&clearTimeout(C),C=setTimeout(()=>{WA.state.currentCameraPosition={x:r.x,y:r.y},y=0},1e3))};
