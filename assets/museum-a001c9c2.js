import{b as _}from"./init-ad207eca.js";import{i as q,g as Q,f as I}from"./job-1b9471bc.js";import{t as o}from"./translate-1ba34e64.js";import{t}from"./layers-172ce3de.js";import{g as X,f as Y}from"./firebase-6d97cafc.js";import{i as ee}from"./hiddenZone-85a4635d.js";import{r as x}from"./config-adf52b6e.js";import{o as l,t as n}from"./discussionv2-8cccfd78.js";import{h as y,i as se,d as M}from"./inventory-ee95aa34.js";import{s as oe}from"./hooking-57e8ac30.js";import{n as ae}from"./notifications-bb73e947.js";import{h as te,a as g,b as u,d as w}from"./sounds-bea9d6c6.js";import{i as ie,g as re,a as le,c as ne,s as ce,o as me}from"./cameraMovingMode-25e0b85e.js";import{c as ue,i as de,o as pe,d as ye}from"./digicode-874dab7a.js";import{o as ge}from"./init-13cd6e65.js";_();let C,b=0;const F=()=>{WA.ui.actionBar.removeButton("planButton")},S=async a=>{WA.ui.modal.closeModal(),setTimeout(()=>{l(n.mapRetrieved,"museum.goToTheNextRoom","museum.go","discussion",async()=>{a==null||a.stop(),F(),await Y(O),WA.nav.goToRoom("maze.tmj")})},1e3)},O="museum";ge(O).then(async()=>{await q(),WA.state.mapRetrieved=!1;let a,r,B={volume:.1,loop:!1,rate:1,detune:1,delay:0,seek:0,mute:!1},T={volume:.1,loop:!1,rate:1,detune:1,delay:0,seek:0,mute:!1};if(X().then(e=>{(e==null?void 0:e.choice)!="online"&&(a=WA.sound.loadSound(`${x}/sounds/electro.mp3`),r=WA.sound.loadSound(`${x}/sounds/electroLow.mp3`),r.play(T))}),WA.state.onVariableChange("mapRetrieved").subscribe(e=>{e&&S(r)}),WA.state.mapRetrieved||y("secret-map")){WA.state.mapRetrieved=!0,S(r);return}WA.room.onEnterLayer("electroH").subscribe(()=>{r==null||r.stop(),a==null||a.play(B)}),WA.room.onLeaveLayer("electroH").subscribe(()=>{a==null||a.stop(),r==null||r.play(T)}),ue("chestDigicode",[{code:"160616",callback:()=>{WA.state.mapRetrieved=!0,u("retrieveMap")}}]),de();let d=null;WA.room.onEnterLayer("chestZone").subscribe(()=>{te("retrieveMap")||(d=WA.ui.displayPlayerMessage({message:o("utils.executeAction",{action:o("museum.inspect")}),callback:()=>{pe("chestDigicode")}}))}),WA.room.onLeaveLayer("chestZone").subscribe(()=>{d==null||d.remove(),d=null}),ie(),se();const D=()=>{F(),l(n.mySelf,"views.museum.beginDiscussion","views.choice.close","discussion",()=>{WA.controls.restorePlayerControls(),V()})};(()=>{WA.controls.disablePlayerControls(),l(n.voiceOver,"views.museum.beginText","museum.go","discussion",()=>{D()})})();const V=()=>{WA.ui.actionBar.addButton({id:"planButton",label:o("museum.plan"),callback:()=>{D()}})};let h=!1,A=null;const z=()=>{A=setInterval(()=>{t("lights/lights1",h),t("lights/lights2",!h),h=!h},300)},H=()=>{A&&clearInterval(A),A=null},R=()=>{z(),t("lights/lights1",!0),t("lights/lights2",!0),t("noLights/noLights",!1),t("noLights/conversations",!1),t("lights/conversations",!0)},N=()=>{H(),t("lights/lights1",!1),t("lights/lights2",!1),t("noLights/noLights",!0),t("noLights/conversations",!0),t("lights/conversations",!1)};oe("hookingD7",()=>{const e=[];e.push({x:5,y:67,tile:null,layer:"hookingD7/collides"}),WA.room.setTiles(e)});let f=null;WA.room.onEnterLayer("closeDoorMessage").subscribe(()=>{f=WA.ui.displayPlayerMessage({message:o("museum.doorClosed"),callback:()=>{}})}),WA.room.onLeaveLayer("closeDoorMessage").subscribe(()=>{f==null||f.remove()}),g("keeperDoorOpen",()=>{const e=[];e.push({x:25,y:44,tile:null,layer:"bigRoomAccess/bigRoomCollides"}),e.push({x:26,y:44,tile:null,layer:"bigRoomAccess/bigRoomCollides"}),WA.room.setTiles(e),WA.room.hideLayer("doorsClosed/dc6")},!1);let W=null;WA.room.onEnterLayer("bigRoomAccess/keeperZone").subscribe(()=>{W=WA.ui.displayPlayerMessage({message:o("utils.executeAction",{action:o("museum.speakToKeeper")}),callback:()=>{y("id-card")?(l(n.keeperName,"views.museum.bigRoomAccess"),u("keeperDoorOpen")):l(n.keeperName,"views.museum.bigRoomNoAccess")}})}),WA.room.onLeaveLayer("bigRoomAccess/keeperZone").subscribe(()=>{W==null||W.remove()});for(let e=1;e<8;e++)ee([{stepIn:`fogsZone/fog${[e]}`,hide:`fogs/fog${[e]}`}]);const G=e=>{let s=null;WA.room.onEnterLayer(`search/s${e}`).subscribe(()=>{e===5&&!y("id-card")?s=WA.ui.displayPlayerMessage({message:o("utils.executeAction",{action:o("museum.search")}),callback:()=>{M({id:"id-card",name:"museum.idCardTitle",image:"indentity-card.png",description:"museum.idCardDescription"})}}):s=WA.ui.displayPlayerMessage({message:o("utils.executeAction",{action:o("museum.search")}),callback:()=>{s=WA.ui.displayPlayerMessage({message:o("museum.searchEmpty"),callback:()=>{}})}})}),WA.room.onLeaveLayer(`search/s${e}`).subscribe(()=>{s==null||s.remove()})};for(let e=1;e<8;e++)G(e);const J=e=>{let s=null;WA.room.onEnterLayer(`pickPocketInvited/i${e}`).subscribe(()=>{s=WA.ui.displayPlayerMessage({message:o("utils.executeAction",{action:o("museum.pickpocket")}),callback:()=>{w("switchLights")?l(n.museumGuest,"museum.cannotPickPocket","views.choice.close","discussion",()=>{l(n.mySelf,"museum.needDistraction","views.choice.close","discussion")}):e===8&&!y("access-card")?M({id:"access-card",name:"museum.accessCard",image:"gold-key.png",description:"museum.accessCardDescription"}):s=WA.ui.displayPlayerMessage({message:o("museum.pickpocketEmpty"),callback:()=>{}})}})}),WA.room.onLeaveLayer(`pickPocketInvited/i${e}`).subscribe(()=>{s==null||s.remove()})};for(let e=1;e<13;e++)J(e);let c=null;WA.room.onEnterLayer("desktopAccessZone").subscribe(()=>{y("access-card")?c=WA.ui.displayPlayerMessage({message:o("utils.executeAction",{action:o("museum.desktopOpen")}),callback:()=>{c=WA.ui.displayPlayerMessage({message:o("museum.desktopOpenMsg"),callback:()=>{u("desktopDoorOpen")}})}}):c=WA.ui.displayPlayerMessage({message:o("museum.doorClosed"),callback:()=>{}})}),WA.room.onLeaveLayer("desktopAccessZone").subscribe(()=>{c==null||c.remove()});for(let e=0;e<9;e++){let s=null;WA.room.onEnterLayer(`desktopItems/i${e}`).subscribe(()=>{s=WA.ui.displayPlayerMessage({message:o("utils.executeAction",{action:o("museum.search")}),callback:()=>{e===0?l(n.annuaryTitle,"views.museum.annuaryContent"):s=WA.ui.displayPlayerMessage({message:o(`museum.desktopItems${e}`),callback:()=>{}})}})}),WA.room.onLeaveLayer(`desktopItems/i${e}`).subscribe(()=>{s==null||s.remove()})}const m=["cameraZones/cZone1","cameraZones/cZone2","cameraZones/cZone3","cameraZones/cZone4","cameraZones/cZone5","cameraZones/cZone6"],Z=[{x:8*32,y:68*32},{x:26*32,y:68*32},{x:15*32,y:63*32},{x:10*32,y:27*32},{x:47*32,y:23*32},{x:47*32,y:42*32}],i=re(),U={room1:{x:5*32,y:60*32,width:i,height:i},room2:{x:5*32,y:44*32,width:i,height:i},room3:{x:3*32,y:3*32,width:i,height:i},room4:{x:60*32,y:4*32,width:i,height:i},room5:{x:50*32,y:32*32,width:i,height:i},room6:{x:31*32,y:51*32,width:i,height:i},room7:{x:37*32,y:33*32,width:i,height:i}};g("retrieveMap",()=>{M({id:"secret-map",name:"museum.secretMap.title",image:"secret-map.png",description:"museum.secretMap.description"}),ae("museum.mapRetrieved","utils.success","success"),t(["chestOpened"],!0),ye()},!1),g("desktopDoorOpen",()=>{const e=[];e.push({x:38,y:11,tile:null,layer:"desktopCollides"}),e.push({x:39,y:11,tile:null,layer:"desktopCollides"}),WA.room.setTiles(e),WA.room.hideLayer("doorsClosed/dc4")},!1);let k=null;g("deactivateCamera",e=>{for(let s=0;s<m.length;s++)t(m[s],!0);t(e,!1),k===e&&WA.controls.restorePlayerControls()},""),g("switchLights",e=>{e?R():N()},!0),setTimeout(()=>{u("switchLights",!0),R()},200),WA.player.state.askForSwitchLights=!0,WA.player.state.askForDeactivateCamera=!1,WA.player.state.askForCloseComputerWebsite=!1,WA.player.state.askForSeeRoom=!1,WA.player.state.onVariableChange("askForDeactivateCamera").subscribe(e=>{e&&u("deactivateCamera",e)}),WA.player.state.onVariableChange("askForCloseComputerWebsite").subscribe(e=>{e&&E()}),WA.player.state.onVariableChange("askForSwitchLights").subscribe(e=>{u("switchLights",e)}),WA.player.state.onVariableChange("askForSeeRoom").subscribe(e=>{const s=U["room"+e];le(s.x,s.y),t(`fogs/fog${e}`,!1)});const j=await Q();for(let e=0;e<m.length;e++)WA.room.onEnterLayer(m[e]).subscribe(()=>{w("deactivateCamera")!==m[e]&&(j==="spy"?l(n.mySelf,"museum.cantStayInCamera","utils.close","discussion",async()=>{WA.controls.disablePlayerControls(),await WA.player.moveTo(Z[e].x,Z[e].y),WA.controls.restorePlayerControls()}):(k=m[e],l(n.mySelf,"museum.cannotWalkInCameras","utils.close","discussion",()=>{w("deactivateCamera")!==k&&WA.controls.disablePlayerControls()})))});let v=null,P=!1;const K=async()=>{WA.ui.modal.openModal({title:"Camera Map",src:`${x}/views/museum/buildingMap.html`,position:"right",allowApi:!0,allow:"fullscreen"},()=>{E()}),P=!0;const e=WA.state.loadVariable("currentCameraPosition");if(e){const{x:s,y:L}=e;$(s,L)}WA.controls.disablePlayerControls(),WA.player.state.askForCloseComputerWebsite=!1,ce(),me()},E=()=>{v==null||v.close(),v=null,ne(),WA.controls.restorePlayerControls(),WA.camera.followPlayer(!0),P=!1};let p=null;if(WA.room.onEnterLayer("computerZone").subscribe(()=>{p=WA.ui.displayPlayerMessage({message:o("utils.executeAction",{action:o("utils.hack")}),callback:()=>{I("useComputers")?K():l(n.mySelf,"museum.cannotUseComputers","utils.close","discussion")}})}),WA.room.onLeaveLayer("computerZone").subscribe(()=>{p==null||p.remove(),p=null}),I("useComputers"))WA.state.onVariableChange("currentCameraPosition").subscribe(e=>{if(!P)return;const{x:s,y:L}=e;$(s,L)});else{const e=await WA.player.getPosition();WA.state.saveVariable("currentCameraPosition",{x:e.x,y:e.y}).catch(s=>console.error("Something went wrong while saving variable",s)),WA.player.onPlayerMove(s=>{be(s)})}});const $=(a,r)=>{WA.camera.set(a,r,void 0,void 0,!0,!0),b=0,C=void 0},be=a=>{b++,b>5?(WA.state.currentCameraPosition={x:a.x,y:a.y},b=0):(C&&clearTimeout(C),C=setTimeout(()=>{WA.state.currentCameraPosition={x:a.x,y:a.y},b=0},1e3))};
