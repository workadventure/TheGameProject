import{i as b,J as n}from"./job-eb8dc8ef.js";import{t as s}from"./translate-d272070d.js";import{r as i}from"./sounds-5d3f972e.js";import{o as h}from"./discussion-49536565.js";import{o as m}from"./init-0f7c740a.js";import{i as u,g as p,d as A}from"./inventory-cca9f553.js";import{h as d}from"./workadventureFeatures-48ab46db.js";import"./notifications-69979190.js";const l=()=>{WA.ui.banner.closeBanner(),WA.ui.banner.openBanner({id:"banner-players-not-even",text:"You need to be at least 2 players to play this game ðŸ™",closable:!1,timeToClose:0})},W=()=>{const e=[...WA.players.list()].find(o=>o.state.job=="spy");return e==null?void 0:e.name},g=()=>{const e=[...WA.players.list()].find(o=>o.state.job=="archaeologist");return e==null?void 0:e.name},a=()=>{const e=WA.state.loadVariable(n.spyPlayer),o=WA.state.loadVariable(n.archaeologistPlayer);WA.ui.banner.closeBanner(),WA.ui.banner.openBanner({id:"banner-players-not-even",text:`${e?e.name:"----"} ðŸ‘€   ${o?o.name:"----"} ðŸ‘¨â€ðŸŒ¾`,closable:!1,timeToClose:0})},y=()=>{WA.state.saveVariable("allPlayersGotJob",!1);const e=[...WA.players.list()].length===1&&[...WA.players.list(),WA.player].reduce((o,t)=>(o.push(t.state.job),o),Array());!e||!e.includes("spy")||!e.includes("archaeologist")||WA.state.saveVariable("allPlayersGotJob",!0)};m().then(async()=>{const e=WA.sound.loadSound(`${i}/sounds/choice.mp3`);let o={volume:.2,loop:!0,rate:1,detune:1,delay:0,seek:0,mute:!1};e.play(o),u(),await b(),d(),h("utils.voiceOver","choice.scenario");let t=!1;WA.room.onEnterLayer("talk").subscribe(()=>{if(t){WA.chat.open();return}WA.chat.sendChatMessage(s("views.choice.text"),`${s("views.choice.title")} ðŸ•µï¸â€â™‚ï¸`),t=!0}),WA.room.onEnterLayer("spy").subscribe(async()=>{if(W()!=null){WA.chat.sendChatMessage("Sorry, the spy job is already taken ðŸ˜±",`${s("views.choice.title")} ðŸ•µï¸â€â™‚ï¸`);return}WA.ui.modal.openModal({allowApi:!0,position:"center",allow:"fullscreen",title:"become spy",src:`${i}/views/choice/becomeSpy.html`},()=>{WA.controls.restorePlayerControls(),y()})}),WA.room.onEnterLayer("archeo").subscribe(async()=>{if(g()!=null){WA.chat.sendChatMessage("Sorry, the spy job is already taken ðŸ˜±",`${s("views.choice.title")} ðŸ•µï¸â€â™‚ï¸`);return}WA.ui.modal.openModal({allowApi:!0,position:"center",allow:"fullscreen",title:"become spy",src:`${i}/views/choice/becomeArchaeologist.html`},()=>{WA.controls.restorePlayerControls(),y()})});let c;WA.room.onEnterLayer("croissants").subscribe(()=>{c=WA.ui.displayActionMessage({message:s("utils.executeAction",{action:s("choice.takeCroissantMessage")}),callback:()=>{const r=p().length;A({id:`croissant${r}`,name:"Croissant",description:"choice.looksDelicious",image:"croissant.png"})}})}),WA.room.onLeaveLayer("croissants").subscribe(()=>{c.remove()}),WA.room.onEnterLayer("door_left_zone").subscribe(()=>{WA.room.hideLayer("closedoor_left"),WA.room.showLayer("opendoor_left")}),WA.room.onLeaveLayer("door_left_zone").subscribe(()=>{WA.room.showLayer("closedoor_left"),WA.room.hideLayer("opendoor_left")}),WA.room.onEnterLayer("door_right_zone").subscribe(()=>{WA.room.hideLayer("closedoor_right"),WA.room.showLayer("opendoor_right")}),WA.room.onLeaveLayer("door_right_zone").subscribe(()=>{WA.room.showLayer("closedoor_right"),WA.room.hideLayer("opendoor_right")}),await WA.players.configureTracking(),WA.players.onPlayerEnters.subscribe(async r=>{console.log(`Player ${r.name} entered your nearby zone`),[...WA.players.list()].length===1?a():l()}),WA.players.onPlayerLeaves.subscribe(async r=>{console.log(`Player ${r.name} leave your nearby zone`),[...WA.players.list()].length===1?a():l()}),[...WA.players.list()].length===1?a():l(),WA.state.onVariableChange("allPlayersGotJob").subscribe(r=>{a(),r&&(e.stop(),WA.nav.goToRoom("./museum.tmj"))}),WA.state.onVariableChange(n.spyPlayer).subscribe(r=>{console.info("onVariableChange => spyPlayer",r),a()}),WA.state.onVariableChange(n.archaeologistPlayer).subscribe(r=>{console.info("onVariableChange => archaeologistPlayer",r),a()})}).catch(e=>console.error(e));export{y as c};
