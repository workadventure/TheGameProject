import"./main-531b8551.js";import{a as S,b as $,m as u,c as b,d as v,e as C}from"./firebase-6d97cafc.js";import{t as w}from"./translate-1ba34e64.js";const N=10;document.addEventListener("DOMContentLoaded",async()=>{WA.onInit().then(async()=>{const t=await A();let s=await S(),e=await $();if(!e||!s){t!=null&&T(t);return}let a=0;for(const o in s)s[o].timestamp<a,a=s[o].timestamp;let n=0;for(const o in e)e[o].timestamp<n,n=e[o].timestamp;const c={myGame:n-a};t==null||t.push([u(),c.myGame]);const m=t==null?void 0:t.sort(([,o],[,l])=>o-l);T(m,u())})});const A=async()=>{const t=await b(),s=await v();if(!t||!s){WA.ui.modal.closeModal();return}const e={};for(const a in t){let n=0;for(const m in t[a])t[a][m].timestamp<t[a][m].timestamp,n=t[a][m].timestamp;if(!s[a])continue;let c=0;for(const m in s[a])s[a][m].timestamp<s[a][m].timestamp,c=s[a][m].timestamp;n===0||c===0||(e[a]=n-c)}return Object.entries(e)},T=async(t,s)=>{const e=document.getElementById("ranking");e==null||e.childNodes.forEach(i=>i.remove());let a=!1;for(const[i,f]of t.slice(0,N).entries()){const y=f[0],G=f[1],M=Math.floor(G/6e4),x=Math.floor(G%6e4/1e3),E=`${M}min ${x}s`,d=document.createElement("p");d.classList.add("rank"),d.textContent=`#${i+1} : ${E}`,y===s&&(d.id="myGame"),e==null||e.appendChild(d),a=a||y===s}try{const i=await C();if((i==null?void 0:i.step)==null||(i==null?void 0:i.step)=="choice")return await h()}catch{return await h()}if(a)return;const n=t.findIndex(([i])=>s===i);if(n===-1)return;const m=t[n][1],o=Math.floor(m/6e4),l=Math.floor(m%6e4/1e3),I=`${o}min ${l}s`,p=document.createElement("p");p.textContent="...";const r=document.createElement("p");r.classList.add("rank"),r.id="myGame",r.textContent=`#${n+1} : ${I}`,e==null||e.appendChild(p),e==null||e.appendChild(r),B()},h=async()=>{const t=document.getElementById("title");t&&(t.innerText=await w("views.ranking.start.title"))},B=async()=>{const t=document.getElementById("title");t&&(t.innerText=await w("views.ranking.end.title"))};
