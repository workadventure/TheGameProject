import{b as W}from"./init-ad207eca.js";import{i as g}from"./job-1b9471bc.js";import{t as l}from"./translate-1ba34e64.js";import{g as L,i as p}from"./firebase-6d97cafc.js";import{i as f,r as u}from"./secretPassages-caadd232.js";import{i as d}from"./hiddenZone-85a4635d.js";import{r as A}from"./config-adf52b6e.js";import{i as k,s as F}from"./readRunes-ae3687d4.js";import{i as v,p as n,c as x,a as y,h as m,b as o}from"./sounds-bea9d6c6.js";import{s as w,t as c}from"./arrayFilling-3bc428d4.js";import{o as E}from"./init-13cd6e65.js";import{d as P,b as R}from"./ui-ca9d2579.js";import{a as S}from"./ranking-b78242be.js";W();const D="escape";E(D).then(async()=>{P(),R();let r;L().then(e=>{(e==null?void 0:e.choice)!="online"&&(r=WA.sound.loadSound(`${A}/sounds/cavedark.mp3`),r.play({volume:.1,loop:!1,rate:1,detune:1,delay:0,seek:0,mute:!1}))}),await g(),v([{name:"finalSound",path:"final.mp3"}]);const b=async()=>{r==null||r.stop(),await WA.ui.website.open({url:`${A}/views/newspaper/newspaper.html`,allowApi:!0,allowPolicy:"",position:{vertical:"middle",horizontal:"middle"},size:{height:"100vh",width:"100vw"}}),p(),S()};WA.room.onEnterLayer("exitZone").subscribe(()=>{n("finalSound"),b()}),f(["secretPassage"],[()=>{console.info("secret passage discovered !")}],[[{x:38,y:6},{x:39,y:6},{x:40,y:6},{x:39,y:7},{x:40,y:7},{x:39,y:8},{x:40,y:8},{x:39,y:9},{x:40,y:9},{x:39,y:10},{x:40,y:10}]]);for(let e=1;e<11;e++)d([{stepIn:`eyes/eye${[e]}`,hide:`blackFogs/blackFog${[e]}`}]);d([{stepIn:"stepMapFog1",hide:"mapFog1"}]),d([{stepIn:"stepMapFog2",hide:"mapFog2"}]),k(),F("runeZone",{content:"escape.content",title:"escape.title"}),x("victory",["blue","yellow","red"],()=>{WA.room.hideLayer("runes/lightOff"),WA.room.showLayer("runes/lightOn"),n("successSound"),u("victoryRunes",[{x:30,y:31},{x:31,y:31},{x:32,y:31}]),WA.room.hideLayer("victoryRunesWall"),WA.room.hideLayer("victoryRunes/victoryFog"),WA.room.showLayer("victoryRunes/openedWall"),WA.camera.set(34*32,34*32,void 0,void 0,!1,!0)}),w("readRunesEscape",[["blue","yellow","red"]],()=>{h()},()=>{}),y("blue",e=>{e?(WA.room.hideLayer("runes/angel"),WA.room.showLayer("runes/angelOn")):(WA.room.hideLayer("runes/angelOn"),WA.room.showLayer("runes/angel"))},!1);let a=null;WA.room.onEnterLayer("runes/left").subscribe(()=>{!WA.state.runesVictory&&!m("blue")&&(a=WA.ui.displayPlayerMessage({message:l("escape.active"),callback:()=>{o("blue",!0),c("readRunesEscape","blue")}}))}),WA.room.onLeaveLayer("runes/left").subscribe(()=>{a==null||a.remove()}),y("red",e=>{e?(WA.room.hideLayer("runes/demon"),WA.room.showLayer("runes/demonOn")):(WA.room.hideLayer("runes/demonOn"),WA.room.showLayer("runes/demon"))},!1);let s=null;WA.room.onEnterLayer("runes/center").subscribe(()=>{!WA.state.runesVictory&&!WA.state.demon&&(s=WA.ui.displayPlayerMessage({message:l("escape.active"),callback:()=>{o("red",!0),c("readRunesEscape","red")}}))}),WA.room.onLeaveLayer("runes/center").subscribe(()=>{s==null||s.remove()}),y("yellow",e=>{e?(WA.room.hideLayer("runes/knight"),WA.room.showLayer("runes/knightOn")):(WA.room.hideLayer("runes/knightOn"),WA.room.showLayer("runes/knight"))},!1);let i=null;WA.room.onEnterLayer("runes/right").subscribe(()=>{!WA.state.runesVictory&&!WA.state.knight&&(i=WA.ui.displayPlayerMessage({message:l("escape.active"),callback:()=>{o("yellow",!0),c("readRunesEscape","yellow")}}))}),WA.room.onLeaveLayer("runes/right").subscribe(()=>{i==null||i.remove()});const h=()=>{setTimeout(()=>{o("red",!1),o("blue",!1),o("yellow",!1),n("failureSound")},300)};WA.room.onEnterLayer("dalles/dK").subscribe(()=>{WA.room.showLayer("dalles/dKPush")}),WA.room.onLeaveLayer("dalles/dK").subscribe(()=>{WA.room.hideLayer("dalles/dKPush")}),WA.room.onEnterLayer("dalles/dA").subscribe(()=>{WA.room.showLayer("dalles/dAPush")}),WA.room.onLeaveLayer("dalles/dA").subscribe(()=>{WA.room.hideLayer("dalles/dAPush")}),WA.room.onEnterLayer("dalles/dD").subscribe(()=>{WA.room.showLayer("dalles/dDPush")}),WA.room.onLeaveLayer("dalles/dD").subscribe(()=>{WA.room.hideLayer("dalles/dDPush")}),y("artifactBrok",()=>{o("artifactBrok",!0),WA.room.hideLayer("artifact"),WA.room.showLayer("brokenArtifact"),WA.room.hideLayer("blackFogs/blackFog6"),n("successSound"),u("finishedDoor",[{x:8,y:2},{x:8,y:3},{x:11,y:6},{x:12,y:6},{x:13,y:6},{x:11,y:9},{x:12,y:9},{x:13,y:9},{x:7,y:12},{x:8,y:12},{x:9,y:12},{x:7,y:15},{x:8,y:15},{x:9,y:15}]),WA.room.hideLayer("finishedWall1"),WA.room.hideLayer("finishedWall2"),WA.room.showLayer("finishedDoor/openedDoor2"),WA.room.hideLayer("templeDoorEmpty"),WA.room.showLayer("templeDoorLight"),WA.room.hideLayer("blackFogs/blackFog1"),WA.room.hideLayer("blackFogs/blackFog2"),WA.room.hideLayer("blackFogs/blackFog3"),WA.room.hideLayer("blackFogs/blackFog4"),WA.room.hideLayer("blackFogs/blackFog5"),WA.room.hideLayer("blackFogs/blackFog6"),WA.room.hideLayer("blackFogs/blackFog7"),WA.room.hideLayer("blackFogs/blackFog8"),WA.room.hideLayer("blackFogs/blackFog9"),WA.room.hideLayer("blackFogs/blackFog10")});let t=null;WA.room.onEnterLayer("artifactZone").subscribe(()=>{m("artifactBrok")||(t=WA.ui.displayPlayerMessage({message:l("escape.artifact"),callback:()=>{o("artifactBrok"),WA.camera.set(9*32,4*32,void 0,void 0,!1,!0)}}))}),WA.room.onLeaveLayer("artifactZone").subscribe(()=>{m("artifactBrok")||t==null||t.remove()})});
