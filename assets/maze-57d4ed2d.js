import{e as F,i as L}from"./job-3640a1b2.js";import{t as a}from"./translate-df78904b.js";import{p as y}from"./sounds-79026e5d.js";import{f as u,s as S,h as c}from"./firebase-a8cde200.js";import{i as f}from"./hiddenZone-85a4635d.js";import{r as w}from"./config-adf52b6e.js";import{i as B}from"./switchingTiles-690b0cbb.js";import{r as n,i as T,d as i}from"./inventory-ebf79eb7.js";import{s as z}from"./hooking-ddfb7ed2.js";import{h as G}from"./workadventureFeatures-48ab46db.js";import{o as v}from"./init-f6d11096.js";import{d as $,a as O,b as R}from"./ui-ca9d2579.js";import"./notifications-bb73e947.js";let d=null;const p=(e=["excavationZone"],r=null)=>{for(let o=0;o<e.length;o++)WA.state[`${e[o]}Discovered`]?(WA.room.hideLayer(`${e[o]}/trace`),WA.room.hideLayer(`${e[o]}/search`),WA.room.showLayer(`${e[o]}/found`),r&&r[o]&&r[o]()):(F("makeExcavation")?(WA.room.showLayer(`${e[o]}/trace`),WA.room.onEnterLayer(`${e[o]}/trace`).subscribe(()=>{WA.state[`${e[o]}Discovered`]||(d=WA.ui.displayActionMessage({message:a("utils.executeAction",{action:a("modules.excavation.makeExcavations")}),callback:()=>{WA.state[`${e[o]}Discovered`]=!0}}))}),WA.room.onLeaveLayer(`${e[o]}/trace`).subscribe(()=>{d==null||d.remove()})):(WA.room.hideLayer(`${e[o]}/trace`),WA.room.hideLayer(`${e[o]}/search`),WA.room.hideLayer(`${e[o]}/found`)),WA.state.onVariableChange(`${e[o]}Discovered`).subscribe(()=>{E(e[o],r?r[o]:null)}))},E=(e,r=null)=>{WA.room.hideLayer(`${e}/trace`),WA.room.showLayer(`${e}/search`),setTimeout(()=>{WA.room.showLayer(`${e}/found`),setTimeout(()=>{WA.room.hideLayer(`${e}/search`),y("successSound"),r&&r()},1e3)},3e3)},g="maze";v(g).then(async()=>{$(),O(),R();let e=null;WA.room.onEnterLayer("triggerBlue").subscribe(()=>{WA.state.blueFire?e=WA.ui.displayActionMessage({message:a("maze.fireOn"),callback:()=>{}}):WA.player.state.hasFoundBlueSeed?e=WA.ui.displayActionMessage({message:a("maze.triggerBlue"),callback:()=>{n("powder"),WA.state.blueFire=!0}}):e=WA.ui.displayActionMessage({message:a("maze.empty"),callback:()=>{}})}),WA.room.onLeaveLayer("triggerBlue").subscribe(()=>{e==null||e.remove()});let r=null;WA.room.onEnterLayer("triggerRed").subscribe(()=>{WA.state.redFire?r=WA.ui.displayActionMessage({message:a("maze.fireOn"),callback:()=>{}}):WA.player.state.hasFoundRedSeed?r=WA.ui.displayActionMessage({message:a("maze.triggerRed"),callback:()=>{n("gem"),WA.state.redFire=!0}}):r=WA.ui.displayActionMessage({message:a("maze.empty"),callback:()=>{}})}),WA.room.onLeaveLayer("triggerRed").subscribe(()=>{r==null||r.remove()});let o=null;WA.room.onEnterLayer("triggerGreen").subscribe(()=>{WA.state.greenFire?o=WA.ui.displayActionMessage({message:a("maze.fireOn"),callback:()=>{n("seed"),WA.state.greenFire=!0}}):WA.player.state.hasFoundGreenSeed?o=WA.ui.displayActionMessage({message:a("maze.triggerGreen"),callback:()=>{n("seed"),WA.state.greenFire=!0}}):o=WA.ui.displayActionMessage({message:a("maze.empty"),callback:()=>{}})}),WA.room.onLeaveLayer("triggerGreen").subscribe(()=>{o==null||o.remove()}),WA.state.onVariableChange("blueFire").subscribe(s=>{s&&(m(),l())}),WA.state.onVariableChange("redFire").subscribe(s=>{s&&(h(),l())}),WA.state.onVariableChange("greenFire").subscribe(s=>{s&&(A(),l())}),WA.room.onEnterLayer("exit").subscribe(()=>{W.stop()});const W=WA.sound.loadSound(`${w}/sounds/forest.mp3`);let b={volume:.1,loop:!1,rate:1,detune:1,delay:0,seek:0,mute:!1};W.play(b);for(let s=1;s<10;s++)f([{stepIn:`fogFloor/fog${[s]}`,hide:`fog/fog${[s]}`}]);T(),await M(),await L(),G(),WA.player.state.onVariableChange("hasFoundRedSeed").subscribe(()=>{}),WA.player.state.onVariableChange("hasFoundGreenSeed").subscribe(()=>{WA.room.hideLayer("excavations/exca6/found")}),WA.player.state.onVariableChange("hasFoundBlueSeed").subscribe(()=>{WA.room.hideLayer("blueSeed")}),f([{stepIn:"hiddenZoneFloor/hiddenZoneFloor",hide:"hiddenZoneTop"}]),z("hiddenZoneFloor/hooking",async()=>{await x()}),p(["excavations/exca1","excavations/exca2","excavations/exca3","excavations/exca4","excavations/exca5"],[()=>{console.info("Excavation has been made !")}]);let t=null;p(["excavations/exca6"],[()=>{WA.room.onEnterLayer("excavations/exca6/found").subscribe(()=>{WA.player.state.hasFoundGreenSeed||(t=WA.ui.displayActionMessage({message:a("maze.takeSeedMsg"),callback:async()=>{await D()}}))}),WA.room.onLeaveLayer("excavations/exca6/trace").subscribe(()=>{t==null||t.remove()})}]),B(["switchingTiles"],[()=>{WA.room.hideLayer("blueArtifact"),WA.room.showLayer("blueSeed"),WA.room.showLayer("switchTileVictory"),WA.room.onEnterLayer("blueSeed").subscribe(()=>{WA.player.state.hasFoundBlueSeed||(t=WA.ui.displayActionMessage({message:a("maze.takePowderMsg"),callback:async()=>{await k()}}))}),WA.room.onLeaveLayer("blueSeed").subscribe(()=>{t==null||t.remove()})}])});async function M(){await u("hasFoundBlueSeed").then(e=>{e==null||e.find==!1?(WA.player.state.hasFoundBlueSeed=!1,WA.state.blueFire=!1):(WA.player.state.hasFoundBlueSeed=!0,WA.state.blueFire=!0)}).catch(e=>{console.warn("Error getting document:",e),WA.player.state.hasFoundBlueSeed=!1,WA.state.blueFire=!1}),await u("hasFoundGreenSeed").then(e=>{e==null||e.find==!1?(WA.player.state.hasFoundGreenSeed=!1,WA.state.greenFire=!1):(WA.player.state.hasFoundGreenSeed=!0,WA.state.greenFire=!0)}).catch(e=>{console.warn("Error getting document:",e),WA.player.state.hasFoundGreenSeed=!1,WA.state.greenFire=!1}),await u("hasFoundRedSeed").then(e=>{e==null||e.find==!1?(WA.player.state.hasFoundRedSeed=!1,WA.state.redFire=!1):(WA.player.state.hasFoundRedSeed=!0,WA.state.redFire=!0)}).catch(e=>{console.warn("Error getting document:",e),WA.player.state.hasFoundRedSeed=!1,WA.state.redFire=!1}),WA.player.state.hasFoundBlueSeed&&i({id:"powder",name:a("maze.powder"),image:"shard.png",description:a("maze.powderDescription")}),WA.player.state.hasFoundGreenSeed&&i({id:"seed",name:a("maze.seed"),image:"seed.png",description:a("maze.seedDescription")}),WA.player.state.hasFoundRedSeed&&i({id:"gem",name:a("maze.gem"),image:"gem.png",description:a("maze.gemDescription")}),A(),h(),m(),l(),console.info("Has found blue seed: ",WA.player.state.hasFoundBlueSeed),console.info("Has found green seed: ",WA.player.state.hasFoundGreenSeed),console.info("Has found red seed: ",WA.player.state.hasFoundRedSeed),console.info("Blue fire: ",WA.state.blueFire),console.info("Green fire: ",WA.state.greenFire),console.info("Red fire: ",WA.state.redFire)}async function k(){WA.player.state.hasFoundBlueSeed=!0,i({id:"powder",name:a("maze.powder"),image:"shard.png",description:a("maze.powderDescription")}),await c("hasFoundBlueSeed")}async function D(){WA.player.state.hasFoundGreenSeed=!0,i({id:"seed",name:a("maze.seed"),image:"seed.png",description:a("maze.seedDescription")}),await c("hasFoundGreenSeed")}async function x(){WA.player.state.hasFoundRedSeed=!0,i({id:"gem",name:a("maze.gem"),image:"gem.png",description:a("maze.gemDescription")}),await c("hasFoundRedSeed")}const m=()=>{WA.state.blueFire&&(WA.room.hideLayer("torchesTop/offTop/torcheBlueOffTop"),WA.room.hideLayer("torchesBot/offBot/torcheBlueOffBot"),WA.room.showLayer("torchesTop/onTop/torcheBlueOnTop"),WA.room.showLayer("torchesBot/onBot/torcheBlueOnBot"))},A=()=>{WA.state.greenFire&&(WA.room.hideLayer("torchesTop/offTop/torcheGreenOffTop"),WA.room.hideLayer("torchesBot/offBot/torcheGreenOffBot"),WA.room.showLayer("torchesTop/onTop/torcheGreenOnTop"),WA.room.showLayer("torchesBot/onBot/torcheGreenOnBot"))},h=()=>{WA.state.redFire&&(WA.room.hideLayer("torchesTop/offTop/torcheRedOffTop"),WA.room.hideLayer("torchesBot/offBot/torcheRedOffBot"),WA.room.showLayer("torchesTop/onTop/torcheRedOnTop"),WA.room.showLayer("torchesBot/onBot/torcheRedOnBot"))},l=()=>{WA.state.blueFire&&WA.state.redFire&&WA.state.greenFire&&(S(g),y("successSound"),WA.room.showLayer("dragonTopLight"),WA.room.showLayer("dragonLight"),WA.room.showLayer("mountainDoorAnimate"),WA.room.setTiles([{x:16,y:4,tile:null,layer:"collisions"}]),m(),A(),h())};
